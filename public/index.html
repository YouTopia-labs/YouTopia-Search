<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTopia - Intelligently Human</title>
    <link rel="icon" href="search.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
    <div class="app-wrapper fade-in">
        <div class="app-container">


            <div class="background-glow"></div>
            <header class="app-header">
                <div class="logo">
                    <div class="logo-text">
                        <a href="/" style="text-decoration: none; color: inherit;">YouTopia</a>
                        <span style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 2px;">Intelligently Human</span>
                        <span class="pre-release-tag">[PRE-RELEASE]</span>
                    </div>
                </div>
                <nav class="nav-controls">
                     <div class="dropdown-container" id="donate-dropdown">
                        <button class="btn donate-btn dropdown-toggle">
                            <i class="fas fa-dollar-sign"></i> Donate <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu right">
                            <div class="dropdown-item" onclick="window.open('https://coff.ee/ayushhroyy', '_blank');">
                                <span class="model-name">â˜• Buy me a coffee</span>
                                <span class="model-description">Support via Buy Me a Coffee</span>
                            </div>
                            <div class="dropdown-item" onclick="window.open('https://onlychai.neocities.org/support.html?name=Ayush%20Roy&upi=ayushhroyy@okicici#', '_blank');">
                                <span class="model-name">ðŸ«– Buy me a chai (UPI)</span>
                                <span class="model-description">Support via UPI payment</span>
                            </div>
                        </div>
                    </div>
                    <button id="theme-toggle" class="icon-btn" title="Toggle theme">
                        <i class="fas fa-sun sun-icon"></i>
                        <i class="fas fa-moon moon-icon"></i>
                    </button>
                    <div class="dropdown-container" id="user-dropdown">
                        <button id="user-icon-button" class="icon-btn dropdown-toggle" title="User Profile">
                            <i class="fas fa-user user-icon"></i>
                        </button>
                        <div class="dropdown-menu right user-dropdown-menu">
                            <!-- User Info (visible when signed in) -->
                            <div id="user-info" class="dropdown-item" style="display: none;">
                                <img id="user-profile-pic" src="" alt="Profile Picture">
                                <span id="user-name"></span>
                                <span id="user-status" class="user-status-icon" title=""></span>
                            </div>
                            <!-- Google Sign-In Button (visible when signed out) -->
                            <button id="firebase-sign-in-button" class="dropdown-item google-signin-btn" style="display: none;">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block; width: 20px; height: 20px;"><g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.42-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g></svg>
                                <span>Sign In with Google</span>
                            </button>
                            <!-- Sign Out Button (visible when signed in) -->
                            <button id="signout-button" class="dropdown-item" style="display: none;">Sign Out</button>
                        </div>
                    </div>
                </nav>
            </header>
            <main class="main-content">
                <div class="initial-view-content">
                    <div class="site-title-container">
                        <img src="svg/search.svg" alt="Search logo" class="search-logo">
                        <h1 class="site-title">YouTopia Search</h1>
                    </div>
                    <p class="site-description">An AI search engine that curates and orchestrates human-created content instead of generating content using AI.</p>
                     <div class="search-wrapper">
                        <div class="search-box">
                            <div class="search-input-container">
                                <!-- Rewritten HTML structure for robust alignment -->
                                <div class="textarea-wrapper">
                                    <div class="placeholder-content">
                                        <img src="svg/cat.svg" alt="cat icon" class="placeholder-cat-icon">
                                        <img src="svg/arrow.svg" alt="arrow icon" class="placeholder-arrow-icon blinking-arrow">
                                        <span class="placeholder-text-span">type your query</span>
                                    </div>
                                    <textarea id="query-input" placeholder="" maxlength="2500"></textarea>
                                </div>
                            </div>
                            <div class="search-controls">
                                <div class="search-controls-left">
                                    <div class="dropdown-container" id="model-dropdown">
                                        <button class="btn dropdown-toggle"><i class="fas fa-snowflake"></i> <span id="selected-model">Amaya</span> <i class="fas fa-chevron-down model-dropdown-arrow"></i></button>
                                        <div class="dropdown-menu">
                                            <div class="dropdown-item" data-value="Amaya" data-url="/?model=amaya">
                                                <i class="fas fa-snowflake"></i>
                                                <div>
                                                    <span class="model-name">Amaya</span>
                                                    <span class="model-description">YouTopia's frontier model for detailed responses</span>
                                                </div>
                                            </div>
                                            <div class="dropdown-item" data-value="Amaya Lite" data-url="/?model=amaya-lite">
                                                <i class="fas fa-snowflake"></i>
                                                <div>
                                                    <span class="model-name">Amaya Lite</span>
                                                    <span class="model-description">YouTopia's flash model for quick responses</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="icon-btn" title="Attach file"><i class="fas fa-paperclip"></i></button>
                                </div>
                                <div class="search-controls-right">
                                    <button class="short-response-toggle" id="short-response-toggle" title="Toggle short response">
                                        <span class="toggle-text">short responses</span>
                                    </button>
                                    <button class="send-btn" id="send-btn" title="Send message"><i class="fas fa-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="example-prompts">
                        <div class="example-prompts-grid">
                            <div class="example-prompt-btn" data-query="Compare the population growth of the USA and Korea.">
                                <i class="fas fa-chart-bar"></i>
                                <span>Visualise Data</span>
                            </div>
                            <div class="example-prompt-btn" data-query="What's the latest news about the ISS?">
                                <i class="fas fa-newspaper"></i>
                                <span>Check latest news</span>
                            </div>
                            <div class="example-prompt-btn" data-query='Research "meditation" and its benefits.'>
                                <i class="fas fa-search"></i>
                                <span>Research a topic</span>
                            </div>
                            <div class="example-prompt-btn hide-on-small-screens" data-query='Explain "moksha"'>
                                <i class="fas fa-book-open"></i>
                                <span>Explain a concept</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="main-results-area">
                    <div id="query-heading">
                        <div id="query-text-content"></div>
                        <div class="query-buttons">
                            <button id="show-more-btn" class="query-btn">Show More</button>
                            <button id="show-less-btn" class="query-btn">Show Less</button>
                        </div>
                    </div>
                    <div class="tabs">
                    <div class="tabs">
                        <button class="tab-link active" onclick="openTab(event, 'answer-tab')">Answer</button>
                        <button class="tab-link" onclick="openTab(event, 'sources-tab')">Sources <span id="sources-counter" class="counter"></span></button>
                    </div>
                    <div id="answer-tab" class="tab-content" style="display: block;">
                        <div id="results-container"></div>
                    </div>
                    <div id="sources-tab" class="tab-content">
                        <div id="sources-container"></div>
                    </div>
                </div>

                <div class="search-wrapper" id="bottom-search-wrapper">
                    <div class="search-box compact-search-box">
                        <div class="search-input-container">
                            <div class="textarea-wrapper">
                                <div class="placeholder-content">
                                    <img src="svg/cat.svg" alt="cat icon" class="placeholder-cat-icon">
                                    <img src="svg/arrow.svg" alt="arrow icon" class="placeholder-arrow-icon blinking-arrow">
                                    <span class="placeholder-text-span">type your query</span>
                                </div>
                                <textarea id="query-input-bottom" placeholder="" maxlength="2500"></textarea>
                            </div>
                            <button class="send-btn" id="send-btn-bottom" title="Send message"><i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                </div>
            </main>

        </div>
        
        <!-- Social Media Footer - Only visible on homepage -->
        <footer class="social-footer">
            <div class="social-links">
                <a href="mailto:support@youtopia.co.in" class="social-link" title="Email Support">
                    <i class="fas fa-envelope"></i>
                </a>
                <a href="https://instagram.com/youtopialabs" target="_blank" class="social-link" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://x.com/YouTopia_Labs" target="_blank" class="social-link" title="Twitter">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="https://youtopia-portal.pages.dev" target="_blank" class="social-link" title="YouTopia Portal">
                    <i class="fas fa-globe"></i>
                </a>
            </div>

        </footer>

        <!-- Rate Limit Popup -->
        <div id="rate-limit-popup-overlay" class="popup-overlay">
            <div class="popup-content">
                <h2>Query Limit Exceeded</h2>
                <p>You are out of free queries until <span id="rate-limit-cooldown-timer"></span></p>
                <div id="rate-limit-developer-message">
                    <p>
                        <span style="font-weight: bold;">If you appreciate this project and the answers it provides, please consider supporting it!</span> This is a solo, self-funded research project by a student (me lol).
                        Your donations would help to keep running it for everyone (and fund my coffee for improving it). Contributions over $20 qualify you for the 20x Plus Plan, which includes:
                    </p>
                    <ul>
                        <li>âœ… 200 AI-powered queries per day</li>
                        <li>âœ… Valid for an entire month</li>
                    </ul>
                    <p>To activate the 20x plan after donating, simply email us at <a href="mailto:support@youtopia.co.in">support@youtopia.co.in</a></p>
                    <p>Thank you for your support, it truly makes a difference for me to not implement spyware to collect user data and sell it to whoeverâ€™s buying on 4chan</p>
                </div>
                <div class="popup-actions">
                    <div class="dropdown-container" id="donate-popup-dropdown">
                        <button class="btn donate-btn dropdown-toggle">
                            <i class="fas fa-dollar-sign"></i> Donate <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu right">
                            <div class="dropdown-item" onclick="window.open('https://coff.ee/ayushhroyy', '_blank');">
                                <span class="model-name">â˜• Buy me a coffee</span>
                                <span class="model-description">Support via Buy Me a Coffee</span>
                            </div>
                            <div class="dropdown-item" onclick="window.open('https://onlychai.neocities.org/support.html?name=Ayush%20Roy&upi=ayushhroyy@okicici#', '_blank');">
                                <span class="model-name">ðŸ«– Buy me a chai (UPI)</span>
                                <span class="model-description">Support via UPI payment</span>
                            </div>
                        </div>
                    </div>
                    <button id="rate-limit-close-button" class="btn">Close</button>
                </div>
            </div>
        </div>

        <!-- Sign In Required Popup -->
        <div id="signin-required-popup-overlay" class="popup-overlay">
            <div class="popup-content">
                <h2>Sign In Required</h2>
                <p>Please sign in to continue using YouTopia.</p>
                <button id="firebase-popup-sign-in-button" class="btn google-signin-btn">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block; width: 20px; height: 20px;"><g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.42-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g></svg>
                    <span>Sign In with Google</span>
                </button>
            </div>
        </div>

    </div>
    
    <script src="js/main.js" type="module"></script>

    <!-- Switched to CDN links to fix library loading errors -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut as firebaseSignOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";


        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDTvIqWeT6mm634BTZ_RNtvSX5KTzNlL9w",
            authDomain: "youtopia-search-prod.firebaseapp.com",
            projectId: "youtopia-search-prod",
            storageBucket: "youtopia-search-prod.firebasestorage.app",
            messagingSenderId: "834501863463",
            appId: "1:834501863463:web:b69c0a72e63b7b6b264602",
            measurementId: "G-466B7XWEDK"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Expose Firebase functions globally for main.js to use
        window.firebaseSignIn = () => signInWithPopup(auth, provider);
        window.firebaseSignOut = () => firebaseSignOut(auth);
        window.firebaseAuth = auth; // Expose auth object to listen for state changes
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dropdowns = document.querySelectorAll('.dropdown-container');

            const closeAllDropdowns = (except) => {
                dropdowns.forEach(dropdown => {
                    if (dropdown !== except) {
                        dropdown.querySelector('.dropdown-menu').classList.remove('show');
                    }
                });
            };

            dropdowns.forEach(dropdown => {
                // Ensure toggle and menu exist for the current dropdown
                const toggle = dropdown.querySelector('.dropdown-toggle');
                const menu = dropdown.querySelector('.dropdown-menu');

                // Only proceed if both toggle and menu are found
                if (!toggle || !menu) {
                    console.warn('Dropdown toggle or menu not found for:', dropdown);
                    return;
                }

                toggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isVisible = menu.classList.contains('show');
                    closeAllDropdowns(dropdown);
                    if (!isVisible) {
                        menu.classList.add('show');
                    }
                });

                menu.addEventListener('click', (e) => {
                    const item = e.target.closest('.dropdown-item');
                    if (item && dropdown.id && dropdown.id.startsWith('model-dropdown')) {
                        const value = item.getAttribute('data-value');
                        const url = item.getAttribute('data-url');

                        document.getElementById('selected-model').textContent = value;

                        if (url) {
                            history.pushState({}, '', url);
                        }
                    }
                });
            });

            window.addEventListener('click', () => {
                closeAllDropdowns();
            });

            const setInitialModel = () => {
                const urlParams = new URLSearchParams(window.location.search);
                const model = urlParams.get('model');
                if (model === 'amaya-lite') {
                    document.getElementById('selected-model').textContent = 'Amaya Lite';
                } else {
                    document.getElementById('selected-model').textContent = 'Amaya';
                }
            };

            setInitialModel();
            window.addEventListener('popstate', setInitialModel);
        });

        // Function to open specific tab
        window.openTab = (evt, tabName) => {
            // Declare all variables
            let i, tabcontent, tablinks;

            // Get all elements with class="tab-content" and hide them
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Get all elements with class="tab-link" and remove the class "active"
            tablinks = document.getElementsByClassName("tab-link");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.classList.add("active");
        };
    </script>
</body>
</html>
